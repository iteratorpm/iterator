// cocoon-js-vanilla@1.5.1 downloaded from https://ga.jspm.io/npm:cocoon-js-vanilla@1.5.1/index.js

var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;document.addEventListener("DOMContentLoaded",(function(){var t=0;var createNewID=function(){return(new Date).getTime()+t++};var newcontentBraced=function(e){return"["+e+"]$1"};var newcontentUnderscored=function(e){return"_"+e+"_$1"};var getInsertionNodeElem=function(e,t,a){if(!e)return a.parentNode;if(typeof e==="function"){t&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function.");return e(a)}return typeof e==="string"?t?a[t](e):e==="this"?a:document.querySelector(e):void 0};var cocoonDetach=function(e){return e.parentElement.removeChild(e)};var cocoonGetPreviousSibling=function(e,t){var a=e.previousElementSibling;if(!t)return a;while(a){var n=a.matches(t);if(n)return a;a=a.previousElementSibling}};var cocoonAddFields=function(e,t){e.preventDefault();e.stopPropagation();var a=t;var n=a.getAttribute("data-association");var r=a.getAttribute("data-associations");var i=a.getAttribute("data-association-insertion-template");var o=a.getAttribute("data-association-insertion-method")||a.getAttribute("data-association-insertion-position")||"before";var s=a.getAttribute("data-association-insertion-node");var d=a.getAttribute("data-association-insertion-traversal");var l=parseInt(a.getAttribute("data-count"),10);var u=new RegExp("\\[new_"+n+"\\](.*?\\s)","g");var v=new RegExp("_new_"+n+"_(\\w*)","g");var c=createNewID();var f=i.replace(u,newcontentBraced(c));var p=[];var b=e;if(f===i){u=new RegExp("\\[new_"+r+"\\](.*?\\s)","g");v=new RegExp("_new_"+r+"_(\\w*)","g");f=i.replace(u,newcontentBraced(c))}f=f.replace(v,newcontentUnderscored(c));p=[f];l=isNaN(l)?1:Math.max(l,1);l-=1;while(l){c=createNewID();f=i.replace(u,newcontentBraced(c));f=f.replace(v,newcontentUnderscored(c));p.push(f);l-=1}var g=getInsertionNodeElem(s,d,a);g&&g.length!==0||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct.");p.forEach((function(e,t){var a=e;var n=new CustomEvent("cocoon:before-insert",{bubbles:true,cancelable:true,detail:[a,b]});g.dispatchEvent(n);if(!n.defaultPrevented){var r={before:"beforebegin",prepend:"afterbegin",append:"beforeend",after:"afterend"};var i=r[o];var s=g.insertAdjacentHTML(i,a);i===r.before?s=g.previousElementSibling:i===r.prepend?s=g.firstElementChild:i===r.append?s=g.lastElementChild:i===r.after&&(s=g.nextElementSibling);var d=new CustomEvent("cocoon:after-insert",{bubbles:true,detail:[a,b,s]});g.dispatchEvent(d)}}))};var cocoonRemoveFields=function(e,t){var a=t;var n=a.getAttribute("data-wrapper-class")||"nested-fields";var r=a.closest("."+n);var i=r.parentNode;var o=e;e.preventDefault();e.stopPropagation();var s=new CustomEvent("cocoon:before-remove",{bubbles:true,cancelable:true,detail:[r,o]});i.dispatchEvent(s);if(!s.defaultPrevented){var d=i.getAttribute("data-remove-timeout")||0;setTimeout((function(){if(a.classList.contains("dynamic"))cocoonDetach(r);else{var e=cocoonGetPreviousSibling(a,"input[type=hidden]");e.value="1";r.style.display="none";var t=r.querySelectorAll("input[required]");for(var n=0;n<t.length;n++)t[n].removeAttribute("required")}var s=new CustomEvent("cocoon:after-remove",{bubbles:true,detail:[r,o]});i.dispatchEvent(s)}),d)}};document.addEventListener("click",(function(t){for(var a=t.target;a&&a!==(this||e);a=a.parentNode){if(a.matches(".add_fields")){cocoonAddFields(t,a);return}if(a.matches(".remove_fields")){cocoonRemoveFields(t,a);return}}}),false);var hideRemovedFields=function(){var e=document.querySelectorAll(".remove_fields.existing.destroyed");for(var t=0;t<e.length;t++){var a=e[t];var n=a.getAttribute("data-wrapper-class")||"nested-fields";var r=a.closest("."+n);r.style.display="none"}};document.addEventListener("page:load",hideRemovedFields);document.addEventListener("turbolinks:load",hideRemovedFields);document.addEventListener("turbo:load",hideRemovedFields);hideRemovedFields()}));var t={};export{t as default};

